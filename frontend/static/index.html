<!DOCTYPE html>
<html>

<head>
  <title>Bomberman-dom</title>
  <link rel="icon" type="image/x-icon" href="./bomberman.ico">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Web site created using Web_pilot framework" />
  <link id="fav" rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;,">
  <link rel="stylesheet" href="./index.css">
</head>

<body id="chatContainer">

  <div id="chat"></div>
  <input type="text" id="message" placeholder="Type your message...">
  <button id="send">Send</button>

  <script type="module" src="../components/app.jsx"></script>
  <!-- <script type="module" src="backend/server/server.js"></script> -->
  <!-- <script type="module" src="./server.js"></script> -->
  <script>
    const chat = document.getElementById('chat');
    const messageInput = document.getElementById('message');
    const sendButton = document.getElementById('send');


    //create a server

    //   http.createServer(function (req, res) {
    //   res.writeHead(200, {'Content-Type': 'text/plain'});
    //   res.write('Hello World!');
    //   res.end();
    // }).listen(8080);

    /*//=====> Start Hannah's test <=====

    (async function () {
      const ws = await connectToServer();

      async function connectToServer() {
        const ws = new WebSocket('ws://localhost:8080/ws');
        return new Promise((resolve, reject) => {
          const timer = setInterval(() => {
            if (ws.readyState === 1) {
              clearInterval(timer)
              resolve(ws);
            }
          }, 10);
        });
      }
      ws.addEventListener("error", (event) => {
        console.log("Error from socket WS:", event);
      })

      // Connection opened
      ws.addEventListener("open", (event) => {
        ws.send("Hello Server!");
      });
      //Handle incoming messages
      ws.addEventListener('message', function (event) {
        const message = document.createElement('div');
        message.textContent = event.data;
        chat.appendChild(message);
        chat.scrollTop = chat.scrollHeight; // Scroll chat to bottom
      });

      // Send message when Send button is clicked
      sendButton.addEventListener('click', function () {
        const message = messageInput.value;
        if (message.trim() !== '') {
          socket.send(message);
          messageInput.value = ''; // Clear input field after sending
        }
      });

      // Send message when Enter key is pressed
      messageInput.addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
          sendButton.click();
        }
      });

    })


    *///=====> End Hannah's test <=====

    //Create WebSocket connection
    /* const socket = new WebSocket('ws://localhost:8080');

        socket.addEventListener("error", (event) => {
        console.log("Error from socket WS:", event);
    })

        // Connection opened
        socket.addEventListener("open", (event) => {
          socket.send("Hello Server! Bomberman Helena is here!");
        });

        // Handle incoming messages
        socket.addEventListener('message', function (event) {
          console.log("event inside message front end", event);
          const message = document.createElement('div');
          
          //turn chars into string, from event object: {"type":"Buffer","data":[72,101,108,108,111,32,83,101,114,118,101,114,33]}
          const dataArray = event.target.data.data;
          console.log("event.data.data",dataArray)
          const stringData = String.fromCharCode(...dataArray);

          console.log(stringData); 
          message.textContent = stringData;
          chat.appendChild(stringData);
          chat.scrollTop = chat.scrollHeight; // Scroll chat to bottom
        });*/

        // Send message when Send button is clicked
        /*sendButton.addEventListener('click', function () {
          const message = messageInput.value;
          console.log('button click value:', messageInput.value)
          if (message.trim() !== '') {
            socket.send(message);
            messageInput.value = ''; // Clear input field after sending
          }
        });

        // Send message when Enter key is pressed
        messageInput.addEventListener('keypress', function (event) {
          if (event.key === 'Enter') {
            sendButton.click();
          }
        });*/
  </script>
</body>

</html>